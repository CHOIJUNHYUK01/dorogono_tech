# Script

### TL;DR

`script`, `script async`, `script defer`를 통해 HTML에 JavaScript 파일을 부르고 실행한다. <br />
하지만 이 세 가지는 모두 다르게 로딩되고 실행된다.

- script <br />
  기본적인 방식이다. <br />
  해당 파일을 다운받고 실행하는 동안에는 HTML 파싱을 멈춘다. <br />
  브라우저는 이 행위가 완료될 때까지 페이지 렌더링을 멈춘다.

- script async <br />
  비동기로 다운을 받고, 동시에 HTML 파싱을 진행한다. <br />
  실행이 가능하게 된다면, 그때 실행된다. 그래서 잠재적으로 HTML 파싱이 멈출 수도 있다. <br />
  서로 기다리지 않으며, 실행될 때는 특정 순서가 없다.

- script defer <br />
  비동기로 다운을 받고, HTML 파싱도 동시에 진행된다. <br />
  하지만, 실행은 HTML 파싱이 완료된 이후에 된다.

## script 태그

JavaScript를 사용하기 위함이다. <br />
`async`와 `defer` 속성은 어떻게, 언제 다운받고 실행할지를 바꾼다.

### 기본 script

순서대로 실행된다. <br />
HTML 위에 있다면, 다운받고 HTML 파싱 진행, 반대라면 HTML 파싱 이후에 다운받는다. <br />
마주치는 즉시 실행된다는 의미다. <br />
파일이 크다면, HTML 렌더링이 멈춘다. <br />
그래서 이건 렌더링에 즉각적인 영향을 준다.

페이지 렌더링에 필수적인 스크립트는 <script> 태그를 사용하면 된다.

### script async

비동기로 진행되고, 실행이 가능하게 되면 즉각 실행한다. <br />
그래서 HTML 파싱이 완료 이전에 될 가능성이 있다. <br />
그래도 성능을 향상시키는 방법이 될 수 있다. <br />
파일을 다운받는 동안, HTML 파싱을 할 수 있기 때문이다.

페이지와는 독립적인 스크립트는 <script async>를 사용하면 된다.

### script defer

이 역시 비동기로 진행된다. <br />
하지만 실행은 HTML이 완전히 파싱이 완료된 후에 된다. (DOMContentLoaded) <br />
만약 이 태그가 여럿 있다면, 코드 순서대로 진행된다.

만약 스크립트가 HTML에 의존적이라면 <script defer>를 사용하면 된다.

---

## 정리

- 스크립트가 HTML 콘텐츠와 관련이 없다면, `async`를 사용하라. <br />
  관련이 깊다면, `defer`를 사용하라.

- `async`와 `defer` 속성은 `src`가 없다면 무시된다.

- `async`와 `defer`를 사용하면, `document.write()`는 무시된다.

- 비동기로 스크립트를 다운받음에도 불구하고, 스크립트는 여전히 메인 스레드에서 실행된다. <br />
  그래서 계산이 많이 필요한 스크립트라면, UI를 버벅이게 하거나 멈추게 한다. <br />
  `Partytown`을 사용해 이 문제를 해결할 수 있다. <br />
  이는 스크립트 실행을 `Web Worker`로 옮겨서 하기 때문이다. <br />
  특히 개발자가 코드를 직접 제어할 수 없는 경우에 사용하길 권장한다.
