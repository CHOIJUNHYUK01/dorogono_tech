# 운영 체제와 컴퓨터 시스템의 구조

## 운영 체제의 종류

운영체제는 앞단에 어떤 인테페이스를 두느냐에 따라 `GUI`와 `CUI`로 나뉜다.

### GUI

Graphical User Interface는 그래픽을 사용해 컴퓨터와 상호작용하는 인터페이스다. <br />
`windowOS`, `macOS` 등 현대 OS가 대표적이다.

### CUI

Character User Interface는 사용자가 키보드만을 사용해 문자를 기반으로 상호작용하는 인터페이스다. <br />
예전 OS인 `MS-DOS`, 현재에는 `charGPT`가 대표적이다.

## 운영 체제의 역할

운영체제의 커널이 담당하는 것들이다.

1. CPU 스케줄링과 프로세스 상태 관리 <br />
2. 메모리 관리 <br />
3. 디스크 파일 관리 <br />
4. I/O 디바이스 관리

## 운영 체제의 구조

### OS 부분

1. 인터페이스 (GUI, CUI) <br />
2. 시스템콜 <br />
3. 커널 (I/O 드라이버, 파일 시스템 등)

### 이외 부분

1. 유저 프로그램 <br />
2. 하드웨어

---

## 컴퓨터 시스템의 구조

- CPU: 인터럽트에 의해 메모리에 존재하는 명령어를 해석해 실행하는 일꾼 <br />
- DMA 컨트롤러: CPU의 일을 보조하는 일꾼 <br />
- 메모리: 전자회로에서 데이터, 상태 등을 기록하는 장치 (작업장) <br />
- 타이머: 특정 프로그램에 시간을 다는 역할 <br />
- 디바이스 컨트롤러: I/O 디바이스들의 작은 CPU <br />
- 로컬 버퍼: 디바이스에 달려있는 작은 메모리

SSD, HDD, 쿨러 등도 있지만, 운영체제와 더 밀접히 관련된 하드웨어를 중심으로 적었다.

### CPU

산술 논리 연산 장치, 제어 장치, 레지스터로 구성되어있다. <br />
인터럽트에 의해 메모리에 존재하는 명령어를 해석해서 실행한다.

1. 산술 논리 연산 장치<br />
   `ALU(Arithmetic and Logical Unit)`은 덧셈, 뺄셈, 곱셈, 나눗셈 등 산술 연산과 논리 연산을 하는 회로 장치다.

2. 제어 장치 <br />
   프로세스의 조작을 지시하며, 명령어들을 읽고 해석히며, 데이터 처리를 위한 순서를 결정한다.

3. 레지스터 <br />
   CPU 안에 있는 매우 빠른 임시 기억 장치

---

## 인터럽트

어떤 신호가 들어왔을 때, CPU를 잠깐 정지시키는 것을 말한다. <br />
0으로 숫자를 나누는 산술 연산 오류, 프로세스 오류 등으로 발생한다.

오류 뿐만 아니라 키보드, 마우스 등 I/O 디바이스를 사용할 때의 인터럽트, <br />
우선순위가 높은 프로세스의 발생 등으로 일어난다.

CPU는 메모리에 있는 명령어를 순차적으로 실행하는데, 인터럽트가 발생되면 점프한다. <br />
인터럽트 핸들러 함수가 모여있는 인터럽트 벡터로 간다. <br />
거기서 인터럽트 핸들러 함수 (인터럽트 서비스 루틴, ISR)이 실행되며, 특정 명령어를 실행한다. <br />
이후 인터럽트가 종료되면, 다시 순차적으로 실행한다.

### 종류

하드웨어 인터럽트와 소프트웨어 인터럽트로 나뉜다.

1. 하드웨어 인터럽트

I/O 디바이스 등 하드웨어에서 발생하는 인터럽트다. <br />
예를 들어, 마우스를 기반으로 버튼을 클릭할 경우에 디스크에서 파일 읽기, 쓰기 작업이 완료됐을 때 발동된다.

2. 소프트웨어 인터럽트

트랩(trap)이라고도 한다. <br />
프로세스 오류, 프로세스 종료, 시작 등을 기반으로 프로세스에서 발생하는 인터럽트다. <br />
하드웨어 인터럽트보다 우선 순위가 높다.

---

## 시스템콜과 modebit

### 시스템콜

운영 체제가 커널에 접근하기 위한 인터페이스다. <br />
유저 프로그램이 운영 체제의 서비스를 받기 위해 커널 함수를 호출할 때, 이를 거쳐 호출하도록 설계되어있다. <br />
프로세스 관리(생성, 삭제 등), 파일 관리, 디바이스 관리, 시간 및 날짜 관련 시스템, 프로세스 간 통신 때 이를 통해 커널 함수를 호출한다.

예를 들어, 프로세스를 종료하는 `kill()`이라는 함수가 있다. <br />
이 함수를 발동시키면, 시스템콜을 거쳐서 커널 함수가 호출된다.

### 과정

만약 유저 프로그램이 I/O 요청을 위한 트랩을 발동했다고 해보자.

1. 유저 프로그램이 I/O 요청 트랩 발동 <br />
2. 올바른 I/O 요청인지 확인 <br />
3. 유저 모드가 시스템콜을 통해 커널 모드로 변환 <br />
4. 이후 커널 함수를 실행

- 커널 함수: <br />
  커널 안에 있는 여러 개의 함수를 의미한다. (native function)

- 커널: <br />
  운영 체제의 핵심 부분이자, 시스템콜을 제공한다. <br />
  보안, 메모리, 프로세스, 파일 시스템 등 운영 체제의 중추적인 역할을 한다.

- 유저 모드: <br />
  유저가 접근할 수 있는 영역을 제한적으로 두며, 컴퓨터 자원에 함부로 침범하지 못하는 모드다.

- 커널 모드: <br />
  모든 컴퓨터 자원에 접근할 수 있는 모드다.

- modebit: <br />
  시스템콜이 작동될 때, `modebit`을 기반으로 유저 모드와 커널 모드를 구분한다. <br />
  `modebit`은 1 또는 0 값을 가지는 플래스 변수다. <br />
  1은 유저 모드, 0은 커널 모드를 가리킨다.

### 장점

유저 프로그램은 시스템콜을 기반으로 커널과 분리된다. <br />
즉, 유저 프로그램은 복잡한 파일 시스템과 프로세스 생성 등에 대한 내부 동작을 신경쓸 필요가 없다. <br />
또한, 운영 체제의 관리 하에 프로그램이 운영되므로, 시스템의 안정성과 보안이 강화된다.

예를 들어, 공격자가 만든 카메라 앱 프로그램이 아무 제약없이 커널에 접근할 수 있다고 해보자. <br />
카메라에 관련한 메모리 등이 오염될 수 있고, 이러면 카메라는 내 의도와는 관계없이 실행되어 사생활이 노출될 수도 있다. <br />
이런 것을 방지하기 위해 유저 모드에서 시스템콜로만 커널 모드에 진입할 수 있는 **하나의 통로**를 만든 것이다.
