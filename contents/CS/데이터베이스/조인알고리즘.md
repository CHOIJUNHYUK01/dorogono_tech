# 조인 알고리즘

MySQL에서 특정한 조인 알고리즘, 예를 들어 중첩 루프 조인을 명시적으로 설정하는 건 직접적으로 가능하지 않다. <br />
해당 데이터베이스의 `query optimizer`가 쿼리를 실행할 때, 조인의 종류 중 자동으로 가장 성능이 좋은 알고리즘으로 결정하게 된다. <br />
MySQL 뿐만 아니라, `PostgreSQL`, `Oracle`, `SQL Server`도 동일하다.

중첩 루프 조인을 한 테이블의 각 행에 대해 다른 테이블의 모든 행을 순차적으로 검사하다 조인하는 방법을 말한다.

- 시간 복잡도: <br />
  O(M\*N), 여기서 M과 N은 조인된 두 테이블의 행 수다. <br />
  첫 번째 테이블의 각 행에 대해, 알고리즘은 두 번째 테이블의 모든 행을 스캔한다.

- 성능: <br />
  소규모 데이터셋일 경우에는 잘 작동하지만, 테이블 크기가 커짐에 따라 비효율적이 된다.

### 블록 중첩 루프 조인

중첩 루프 조인에서 발전한 조인 알고리즘으로, 한 테이블의 블록(여러 행의 집합)을 메모리에 한 번에 로드 -> 조인 버퍼라는 메모리 영역에 저장한다. <br />
이후 해당 블록에 대해 다른 테이블의 각 행에 대해 순회하면서 조건에 맞는 행이 있는지를 확인하고, 조인하는 방법이다.

---

## 정렬 병합 조인

두 테이블을 조인할 필드를 기준으로 각각 정렬한 후, 정렬된 순서에 따라 행을 병합하여 조인한다.

- 시간 복잡도: <br />
  O(M log M + N log N), 여기서 M과 N은 두 테이블의 행 수다. <br />
  이는 두 테이블을 정렬한 다음, 병합하는 데 선형 시간이 소요된다.

- 성능: <br />
  데이터가 이미 정렬되어 있을 때, 더 효율적이다. <br />
  또한 등가 조인이 아닌, 비등가 조인인 대소 비교 연산자로 조인할 때 효율적이다.

특정 조인 조건으로 자주 조인하는 경우, 해당 조인 조건에 맞게 데이터를 미리 정렬하거나, 인덱스를 구성함으로써 조인 성능을 향상시킬 수 있다.

---

## 해시 조인

한 테이블의 행을 사용해 해시 테이블을 만든 다음, 다른 테이블을 순회하며, 해시 테이블을 사용해 조인한다. <br />
하나의 테이블이 서버 메모리에 온전히 들어간다면, 중첩 루프 조인보다 더 효율적이다. <br />
다만 메모리가 부족할 경우, 성능이 저하될 수 있다. <br />
동등 조인에서만 사용이 가능하다.

### 작동 방식

- 빌드 단계: <br />
  바이트가 더 작은 테이블로부터 해시 테이블을 생성한다. <br />
  각 행의 조인 키에 해시 함수를 적용해 해시 테이블에 저장한다.

- 프로브 단계: <br />
  다른 테이블의 각 행에 대한 조인키를 해싱하여 앞서 만든 해시값과 비교해서 해시 테이블에서 매칭되는 행을 찾으면, 해당 행들을 조인 결과 테이블에 추가한다.

- 시간 복잡도: <br />
  O(M+N), 여기서 M은 빌드 단계 테이블의 행 수다. <br />
  N은 프로브 단계의 테이블 행 수다.

- 성능: <br />
  큰 데이터셋에 대해 효율적이다. <br />
  특히 두 테이블 사이에 큰 크기 차이가 있을 때, 효율적이다. <br />
  등가 조인에만 사용이 가능하다.
