# 트랜잭션

데이터베이스에서 하나의 논리적 기능을 수행하기 위한 작업의 단위다. <br />
쿼리를 묶는 단위이기도 하다.

### 커밋

여러 쿼리가 성공적으로 처리됐다고 확정하는 명령어다. <br />
트랜잭션 단위로 수행되며, 변경된 내용이 모두 영구적으로 저장된다.

### 롤백

트랜잭션으로 처리한 하나의 묶음 과정을 일어나기 전으로 돌리는 일이다.(취소)

### 트랙잭션 전파

트랜잭션을 수행할 때, 커넥션 단위로 수행한다. <br />
그래서 커넥션 객체를 넘겨서 수행해야 하는데, 이를 넘겨서 수행하지 않고 여러 트랜잭션 관련 메서드의 호출을 하나의 트랜잭션에 묶이도록 하는 것이다.

---

## ACID

### A: 원자성 (all or nothing / atomicity)

트랜잭션과 관련된 일이 모두 수행됐거나, 되지 않았거나를 보장하는 특성이다.

### C: 일관성 (consistency)

"허용된 방식"으로만 데이터를 변경해야 하는 것을 의미한다.

### I: 격리성 (isolation)

트랜잭션 수행시, 서로 끼어들지 못하는 것을 말한다.

### D: 지속성 (durability)

성공적으로 수행된 트랜잭션은 영원히 반영되어야 하는 걸 의미한다.

**무결성이란, 데이터의 정확성, 일관성, 유효성을 유지하는 것을 말한다.**

---

## 격리성

트랜잭션은 서로 끼어들지 못한다는 정의가 있다. <br />
근데 무조건 서로 접근이 불가능할까? 그렇지 않다. <br />
이 격리성은 여러 가지 단계가 있고, 해당 단계에 따라 격리성과 동시성의 정도가 다르다.

트랜잭션이 순차적으로 실행되면, 격리성은 높아지지만 동시성은 머누 낮아져서 성능이 좋지 않게 된다. <br />
격리성과 동시성은 반비례 관계다. <br />
격리성이 높으면, 동시성은 떨어진다. 격리성이 낮으면, 동시성은 올라간다. <br />
이런 단계들은 DB에서 단계를 조정할 수 있다.

MySQL의 경우, 다음과 같은 명령어로 단계를 조절한다.

```sql
set session transaction isolation level read uncommitted;
```

격리 수준에 따라 나타나는 현상들이 있다. <br />
`팬텀 리드`, `반복이 불가능한 조회`, `더티 리드`가 있다.

### 팬텀 리드 (Phantom Reads)

한 트랜잭션 내에서 동일한 쿼리를 2번 이상 보냈을 경우, 해당 조회 결과가 다른 것을 의미한다.

### 반복이 불가능한 조회 (Nonrepeatable Reads)

한 트랜잭션 내의 같은 행에 두 번 이상 조회가 발생했는데, 그 값이 다른 것을 의미한다.

### 더티 리드 (Dirty Reads)

하나의 트랜잭션이 다른 트랜잭션의 아직 커밋되지 않은 데이터를 읽는 현상이다. <br />
T1이 업데이트 이후, 롤백을 해서 커밋되지 않은 데이터가 됐음에도, T2는 이미 커밋이 됐다고 판단했기 때문이다.

---

## 격리 수준

### SERIALIZABLE

커밋이 완료된 데이터에 대해서만 조회가 가능하다. <br />
트랜잭션을 순차적으로 진행시킨다. <br />
여러 트랜잭션이 동시에 같은 행에 접근할 수 없다.

### REPEATABLE_READ

커밋이 완료된 데이터에 대해서만 조회가 가능하다. <br />
반복해서 행을 조회하더라도, 같은 행을 보장하는 단계다. <br />
하나의 트랜잭션이 수정한 행을 다른 트랜잭션이 수정할 수 없게 맞아주지만, 새로운 행을 추가하는 건 막지 않는다. <br />
따라서 같은 범위 쿼리를 실행했을 경우, 이후에 추가된 행이 발견될 수 있다. <br />
이는 `MySQL 8.0`의 `innoDB` 기본값이다. <br />
그래서 `팬텀 리드`가 일어날 수도 있다.

### READ_COMMITED

커밋이 완료된 데이터에 대해서만 조회가 가능하다. <br />
커밋이 되지 않은 정보는 읽지 못한다. <br />
`PostgreSQL`, `SQL Server`, `Oracle`에서 기본값으로 설정되어 있다. <br />
가장 많이 사용되는 격리 수준이다. <br />
`팬텀 리드`, `반복이 불가능한 조회`가 일어날 수 있다.

### READ_UNCOMMITED

가장 낮은 격리 수준이며, 가장 빠르다. <br />
다른 트랜잭션이 커밋하지 않은 정보를 읽을 수 있다. <br />
`팬텀 리드`, `반복이 불가능한 조회`, `더티 리드`가 일어날 수도 있다.
