# TCP의 연결 해제 : 4웨이-핸드셰이크와 TIME_WAIT

TCP의 연결 해제 과정은 4개의 과정으로 이뤄진다.

1. 먼저 클라이언트가 연결을 닫으려고 할 때, `FIN`으로 설정된 세그먼트를 보낸다. <br />
   그리고 클라이언트는 `FIN_WAIT_1` 상태가 되고, 서버의 응답을 기다린다.

2. 서버는 클라이언트로 `ACK`라는 승인 세그먼트를 보내고, `CLOSE_WAIT` 상태가 된다. <br />
   클라이언트가 세그먼트를 받으면, `FIN_WAIT_2`가 된다.

3. 서버는 `LAST_ACK`상태가 되며, 일정 시간 후에, 클라이언트에 `FIN` 세그먼트를 보낸다.

4. 클라이언트는 `TIME_WAIT` 상태가 되고, 서버로 `ACK`을 보내면, 서버는 `closed`가 된다.<br />
   이후 클라이언트는 일정 시간(TIME_WAIT으로 설정된 시간) 대기 후에 연결이 닫힌다.

## TIME_WAIT

지연 패킷 등이 발생했을 때, 데이터 무결성을 해결하기 위해 패킷을 기다리는 시간이다. <br />
2 \* MSL동안 기다린다.

MSL(maximum segment lifetime) : 최대 패킷 수명을 의미한다.

연결이 올바르게 닫힌 상태로 만들기 위해 존재한다. <br />
예를 들어, `CLOSED`가 아닌 `LAST_ACK`로 되어 있으면, 그 다음 연결 때 오류가 나타난다. <br />
그래서 일정 시간을 기다리는 `TIME_WAIT`이 필요한 거다. <br />
이는 OS마다 다르다. 윈도우는 4분, 우분투는 1분이다.
