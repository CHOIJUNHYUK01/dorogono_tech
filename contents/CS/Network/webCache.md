# 웹브라우저 캐시

## 로컬 스토리지

웹 스토리지 객체로, 브라우저 내에 {key: value} 형태로 오리진에 종속되어 저장되는 데이터다. <br />
즉, 오리진이 같은 브라우저 내에서 공유가 된다.

### 특징

1. 하나의 키에 오로지 하나의 값만 저장된다. <br />
2. 데이터는 사용자가 브라우저에서 수동으로 삭제하지 않는 한 평생 로컬 저장소에 저장된다. <br />
   따로 만료날짜가 없다.<br />
   사용자가 창이나 탭을 닫아도, 컴퓨터를 종료해도 마찬가지다. <br />
3. 최대 저장 용량은 5MB다. <br />
4. 보통 사용자의 행위를 기억할 때, 로그인을 유지하기 위한 값 등으로 사용된다. <br />
   로컬 스토리지 데이터는 자동으로 서버에 전송되지 않는다. <br />
   단, 쿠키는 자동으로 전송된다.

### 사용법

- 값 설정하기 : `localStorage.setItem(key, value)` <br />
- 값 가져오기 : `localStorage.getItem(key)` <br />
- 값 제거하기 : `localStorage.removeItem(key)` <br />
- 전체 제거하기 : `localStorage.clear()`

### 로컬스토리지와 오리진

origin = `https://site.com:8080`이다. <br />
프로토콜 + host(hostname + port) = origin이다.

### 캐싱

UX를 개선하기 위해 텍스트 창에 입력한 값을 로컬 스토리지를 통해 저장해 캐싱이 가능하다.

## 세션 스토리지

로컬 스토리지와 매우 유사하다. <br />
세션 스토리지는 웹 스토리지 객체로 브라우저 내에 {key: value} 형태로 오리진에 종속되어 저장되는 데이터다. <br />
다만, 동일한 오리진이라도 각 **탭마다 독립적으로 저장**된다. <br />
즉, 다른 탭에서 세션 스토리지에 저장된 데이터에 접근할 수 없다.

### 특징

1. 하나의 키에 오리지 하나의 값만 저장된다. <br />
2. 최대 저장 용량은 5MB다. <br />
3. 사용자가 브라우저에서 탭을 닫으면 데이터는 만료된다.

### 사용법

- 값 설정하기 : `sessionStorage.setItem(key, value)` <br />
- 값 가져하기 : `sessionStorage.getItem(key)` <br />
- 값 제거하기 : `sessionStorage.removeItem(key)` <br />
- 전체 제거하기 : `sessionStorage.clear()`

> 보통 세션 스토리지보다는 로컬 스토리지를 많이 쓴다.

---

## 쿠키

브라우저에 저장된 데이터 조각이다. <br />
클라이언트에서 먼저 설정할 수도 있고, 서버에서 먼저 설정할 수도 있다. <br />
하지만 보통은 서버에서 먼저 설정해서 쿠키를 만드는 게 일반적이다.

서버에서 응답 헤더로 `Set-Cookie`로 설정해 쿠키를 보낸다. <br />
그때부터 클라이언트에서 요청 헤더로 `Cookie`에 설정되어 자동으로 서버에 전달되게 한다. <br />
그리고 브라우저에도 저장이 된다.

쿠키는 클라이언트와 서버 둘 다 조작이 가능하다. <br />
보통 서버에서 만료 기한 등을 설정하고 제어한다. <br />
저장 용량은 최대 4KB다. <br />
보통 로그인, 장바구니, 사용자 커스터마이징, 사용자 행동 분석(주로 개인화된 광고에 활용되는 것들)에 사용된다.

### 클라이언트에서 설정가능한 쿠키

자바스크립트 - `document.cookie`를 통해 쿠키를 설정할 수 있다.<br />
보낼 때도 아래와 같은 식으로 `header - Cookie`에 값을 정해 보낼 수도 있다. <br />

```javascript
axios.get(url, {
    headers: {
        cookie: "cookie1=value; cookie2=value; cookie3=value;"
    }
}).then(...)
```

하지만 권장하지는 않는 방식이다. <br />
이렇게 되면 쿠키에 대한 제어권을 클라이언트에게 두게 된다. <br />
쿠키에는 보통 민감한 정보가 담길 가능성이 있다. <br />
때문에 이 제어권을 서버가 갖게 만들어야 한다.

### 세션 쿠키

`Expires` 또는 `Max-Age` 속성을 지정하지 않는 것이다. <br />
브라우저가 종료되면 쿠키도 사라진다.

### 영구 쿠키

`Expires` 또는 `Max-Age` 속성을 지정해서 특정 날짜나 일정 기간이 지나면 삭제된다. <br />
브라우저가 종료되도 사라지지 않는다.

### 문법

```
Set-Cookie: <cookie-name>=<cookie-value>
Set-Cookie: <cookie-name>=<cookie-value>; Expires=<date>
Set-Cookie: <cookie-name>=<cookie-value>; Max-Age=<non-zero-digit>
Set-Cookie: <cookie-name>=<cookie-value>; Domain=<domain-value>
Set-Cookie: <cookie-name>=<cookie-value>; Path=<path-value>
Set-Cookie: <cookie-name>=<cookie-value>; Secure
Set-Cookie: <cookie-name>=<cookie-value>; HttpOnly
Set-Cookie: <cookie-name>=<cookie-value>; SameSite=Strict
```

- secure <br />
  쿠키에 이 옵션이 추가되면 `https`로만 쿠키를 주고받을 수 있다. <br />
  하지만 Chrome v89 및 Firefox v75 이상부터 `localhost`에서는 무시된다. <br />
  즉, `localhost`에서는 `http`로도 쿠키를 주고 받을 수 있어, 테스팅이 가능하다.

- httponly <br />
  공격자가 쿠키를 자바스크립트로 빼낼 수 없게 만든다. <br />
  `document.cookie`로 접근을 막는다.

- samesite <br />
  요청이 동일한 도메인에서 시작된 경우에만 쿠키가 앱으로 전송되도록 한다.

### 쿠키의 시큐어 코딩

쿠키 - 세션으로 로그인을 처리한다면, 다음과 같은 시큐어 코딩을 해야 한다.

1. cookie에 세션 ID를 담을 때, 이 세션ID를 기반으로 클라이언트의 개인 정보를 유출할 수 없어야 한다. <br />
2. 자바스크립트로는 파악할 수 없게 `httponly`옵션을 걸고, `https`로만 쿠키를 주고받을 수 있게 `secure`옵션을 걸어야 한다. <br />
3. 일정 시간의 세션 타임아웃을 걸어야 한다.

예시) 로그인 유지시간 등

### 쿠키 허용 관련 알림창

서비스 운용할 때, 쿠키를 사용한다면 쿠키 허용 관련 알림창을 만들어야 한다. <br />
방문 기록을 추적할 때, 쿠키가 사용되기 때문이다. <br />
이는 사용자의 데이터 간접 수집에 해당하며, 거기에 해당하는 KISA 지침을 준수해야 한다.

---

## 로컬 스토리지, 세션 스토리지, 쿠키

### 공통점

1. 브라우저에 캐싱을 해서 서버에 대한 요청을 줄여, 서버 부하를 방지할 수 있다. <br />
2. 캐싱으로 인해 다운로드하는 컨텐츠가 줄어들어, 웹사이트의 컨텐츠를 더 빨리 다운로드가 가능하다. <br />
3. 사이트 기본 설정 커스터마이징을 저장하거나, 로그인 상태를 유지할 때 사용된다.

### 차이점

|                                   | 쿠키              | 로컬 스토리지 | 세션 스토리지  |
| --------------------------------- | ----------------- | ------------- | -------------- |
| 최대 저장 용량                    | 4KB               | 5MB           | 5MB            |
| 브라우저 허용                     | HTML4 + 5         | HTML5         | HTML5          |
| 접근 범위                         | 오리진            | 오리진        | 탭             |
| 만료 기한                         | 수동 설정         | 영구          | 탭 닫으면 소멸 |
| 설정 가능 주체                    | 클라이언트 + 서버 | 클라이언트    | 클라이언트     |
| 요청과 함께 서버에 자동 전송 유무 | O                 | X             | X              |

쿠키와 로컬 스토리지는 오리진이 같은 여러 개의 창이나 탭을 닫아도 유지된다. <br />
html은 웹 페이지를 작성하기 위한 마크업 언어로, 버전이 업그레이드 되고 있다.
