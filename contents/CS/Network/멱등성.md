# HTTP의 멱등성

HTTP의 멱등성 (idempotent)란, <br />
하나의 요청이 아닌 여러 번 동일한 요청을 보냈을 때, 서버가 같은 상태를 갖는 것이다.

HTTP 메서드 중 멱등성을 갖는 메서드는 `GET`, `HEAD`, `OPTIONS`, `PUT`, `DELETE`가 있다. <br />
그렇지 않은 메서드는 `POST`, `PATCH`가 있다.

## 멱등성을 갖는 메서드

**GET** : 이 메서드는 서버에서 정보를 가져오는데 사용한다. <br />
여러 개의 동일한 GET 요청을 하는 건, 한 번의 요청과 같은 효과다. (안전한 메서드)

**HEAD** : 이 메서드는 GET 요청이 생성하는 응답의 헤더를 검색하는 데 사용된다. <br />
보통 리소스 전체를 다운로드하는 오버헤드를 피하고, 어떤 유형의 데이터가 반환되는지, 해당 리소스가 있는지, 수정 날짜 등을 확인하기 위해 쓰인다. <br />
GET처럼 서버 상태를 변경하지 않는다. (안전한 메서드)

**OPTIONS** : 이 메서드는 대상 리소스의 통신 옵션 (서버에서 지원한는 HTTP 메서드 등)을 가져올 때 사용된다. (안전한 메서드)

**PUT** : 이 메서드는 리소스를 완전히 다른 버전으로 대체한다. <br />
요청이 반복되면, 동일한 리소스가 다시 대체되어 첫 번째 요청 후와 동일한 상태가 된다.

**DELETE** : 리소스를 삭제하는 데 사용된다. <br />
리소스가 삭제되면, 삭제 작업을 반복해도 시스템 상태가 더 이상 변경되지 않는다.

## 멱등성을 갖지 않는 메서드

**POST** : 새로운 리소스를 생성하는데 사용된다. <br />
여러 POST 요청은 여러 리소스를 생성하는 결과를 초래한다.

**PATCH** : 리소스를 부분적으로 업데이트하는 데 사용된다. <br />
멱등성 여부는 PATCH를 실행하는 방법에 따라 달라진다. <br />
필드를 특정값으로 수정하는 것이라면, 멱등성을 가진다. <br />
하지만, 특정 필드 값을 변경하거나, 배열에 요소를 추가시킨다면, 갖지 않는다.

---

POST 메서드의 경우, `idempotency Key`를 보내서 동일한 요청인지를 식별하게 한다. <br />
이를 통해 동일한 작업의 재시도를 인식하고, 한 번만 처리되도록 한다. <br />
이는 중복 트랜잭션을 피해야 하는 결제 처리 API에서 자주 사용된다.

---

### 중요한 이유

1. 일관성 <br />
   보통 반복되는 요청이 단일 요청과 동일한 효과를 갖도록 보장하는 것은 시스템 전반에 걸쳐 일관된 상태를 유지하는 데 도움이 된다.

2. 유지 보수성 <br />
   멱등성을 가진 HTTP 메서드로 API로 통신하는 부분에 있어서, 재시도를 처리할 때의 사이드 이펙트를 고려한 복잡한 로직을 구현할 필요가 없다. <br />
   그래서 이 부분을 잘 고려해서 설계한다면, 유지 보수성이 증가한다.
