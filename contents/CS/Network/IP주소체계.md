# IP 주소체계

IP 주소는 인터넷 주소로, IPv4, IPv6로 나뉜다.

## IPv4

32비트로 표현되는 주소체계다. <br />
2의 32승, 41억 9천만 개의 주소 표현이 가능하다. <br />
8비트 단위로 점을 찍어 4개로 구분해서 표현한다. <br />
보통 8비트를 10진수로 표현해서 말한다.

이 주소체계만으로는 부족하기에 NAT, 서브네팅 여러 개의 부수적인 기술이 생겨났다.

## IPv6

128비트로 표현되는 주소체계다. <br />
2의 128승 개의 주소 표현이 가능하다. <br />
16비트씩 8개로 구분되고, 16비트는 16진수로 변환되어 콜론(:)으로 구분해 표시한다. <br />
앞의 연속되는 0은 생략이 가능하다.

앞의 64비트는 네트워크 주소를, 뒤의 64비트는 인터페이스 주소로 이뤄져 있다.

- IPSec이 내장되어있다. <br />
  데이터 패킷을 암호화하는 보안 네트워크 프로토콜 제품군이다.

- 단순해진 헤더 포맷 <br />
  IPv4 헤더의 불필요한 필드를 제거하여 보다 빠른 처리가 가능하다.

- 체크섬이 없다. <br />
  IPv4에만 존재한다. <br />
  IPv4에는 CRC를 통한 손상된 패킷을 확인하고 폐기하는데 쓰는 체크섬 필드가 있다.

  IPv6에는 존재하지 않는다. <br />
  상위 프로토콜(TCP, UDP)에 체크섬 필드가 있기 때문이다. <br />
  헤더의 효율화를 위해 버전이 업그레이드되면서 사라졌다.

  해당 체크섬필드를 사용하고 싶지 않다면, 해당 필드 값을 모두 0으로 만들면 된다. <br />
  이를 통해, 체크섬 필드를 유동적으로 사용하거나 사용하지 않게 할 수 있다. <br />
  다만, IPv6 + UDP라면, 체크섬 필드가 없다. <br />
  그래서 무조건 UDP 헤더의 체크섬 필드를 사용한다고 설정해야 한다.

  IPv4는 헤더가 가변길이지만, IPv6는 고정길이로 40바이트다. <br />
  그래서 "인터넷 헤더길이"에 대한 정보가 없다. <br />
  이외에도 여러가지 불필요한 정보가 삭제됐다.

- TTL은 HOP limit으로 대체됐다.<br />
  TTL은 IPv4에서 패킷이 네트워크에서 무한순환하지 않도록 하는 변수다. <br />
  패킷이 네트워크에서 라우터를 거칠 때마다 TTL 값이 1씩 감소한다. <br />
  값이 0이 되면 패킷이 폐기된다. <br />
  단순히 이름만 대체된 것이고, 역할은 동일하다.

### IPv4와 IPv6 중 어떤 게 좋나요? 더 빠르나요?

IPv6는 IPv4보다 많은 주소를 표현할 수 있다. <br />
IPv4보다 불필요한 헤더가 삭제되어 빠르고, 기본적으로 IPSec이라는 네트워크 보안제품군이 포함되었기 때문에 보안적인 측면에서도 좋다. <br />
보통은 더 빠르긴 하지만, 일부 사례에서는 느린 경우도 존재한다.

---

## 클래스풀 (Classful IP Addressing)

IP주소는 인터넷 주소로 네트워크 주소, 호스트 주소, 두 부분으로 나뉜다. <br />
네트워크 주소는 호스트를 모은 네트워크를 지칭한다.

- 네트워크 주소가 동일 = 로컬 네트워크 <br />
- 호스트 주소 = 호스트를 구분하기 위한 주소 <br />
- 네트워크 호스트 = 컴퓨터 네트워크에 연결된 컴퓨터나 기타 장치

### 정의

네트워크 주소를 매기고, 그에 따라 네트워크 크기를 다르게 구분해 클래스를 할당하는 주소체계다. <br />
구분하는 기준자 (1,2,3옥텟)을 서브넷마스크라 한다.

### 클래스 A

|0|Network(7bit)|Host(24bit)|

1. 2^24 - 2 = 한 네트워크당 16,777,214 호스트 ID(약 1,600만 개) / 0 <br />
2. 네트워크 주소 범위 : 1 ~ 126로 시작 / 원래는 127.255.255.255까지 포함된다. <br />
   하지만 127.X는 루프백 주소이기에 포함하지 않는다. <br />
   0.0.0.0도 특수주소로 포함하지 않는다. (알 수 없는 대상에 달아놓는 임시 주소)

### 클래스 B

|1|0|Network(14bit)|Host(16bit)|

1. 2^16 - 2 = 한 네트워크당 65,534 호스트 ID(6만 5천개) / 10 <br />
2. 네트워크 주소 범위 : 128 ~ 191로 시작

### 클래스 C

|1|1|0|Network(21bit)|Host(8bit)|

1. 2^8 - 2 = 한 네트워크당 254 호스트 ID / 110 <br />
2. 네트워크 주소 범위 : 192 ~ 223으로 시작

### 왜 주소 중 2개를 빼나?

맨 앞자리는 네트워크 주소로 남겨둔다. <br />
마지막 주소는 브로드캐스팅 주소로 남겨놓는다.

### 클래스풀의 문제점은?

네트워크 크기가 작다면, 큰 네트워크를 필요로 하는 조직은 여러 개를 확보해야 하는 어려움이 있다. <br />
또한 작은 네트워크가 필요한 조직은 너무 많은 IP를 가져가서 낭비되기도 한다.

---

## 클래스 리스

클래스풀의 단점을 해결하기 위해 등장했다. <br />
클래스로 나누는 것이 아닌 서브넷 마스크를 중심으로 어디까지가 네트워크 주소고, 어디까지가 호스트 주소인지를 나눈다.

- 서브네팅 : 네트워크를 나눈다는 의미 <br />
- 서브넷 : 서브네트워크, 쪼개진 네트워크 <br />
- 서브넷 마스크 : 서브네트워크를 위한 비트 마스크

현대 주소 체계는 클래스리스를 사용한다.

### 클래스풀과 클래스 리스 차이

- 클래스풀 네트워킹 <br />
  a. IP주소를 A, B, C, D, E 클래스 기반으로 구분한다. <br />
  b. 각 클래스는 고정된 서브넷 마스크(FSM)을 가진다. <br />
  A클래스: 255.0.0.0 <br />
  B클래스: 255.255.0.0 <br />
  C클래스: 255.255.255.0 <br />
  c. 고정된 서브넷 마스크를 사용해 네트워크와 호스트 부분을 나눈다. <br />
  d. IP주소의 첫 번째 옥텟에 따라 클래스가 결정된다.<br />
  A클래스: 1-126, B클래스: 128-191, C클래스: 192-223

- 클래스리스 네트워킹
  a. 클래스 기반의 제한을 없앤다. <br />
  b. 고정된 서브넷 마스크 대신 가변 길이 서브넷 마스크(VLSM)을 사용해 네트워크와 호스트 부분을 동적으로 나눈다. <br />
  c. CIDR 표기법을 사용해 네트워크를 나타낸다. (예: 192.168.0.0/22)<br />
  d. 더 유연하게 네트워크를 할당하고, 주소 낭비를 줄일 수 있다.

- CIDR (classless inter-domain Routing) 표기법 <br />
  네트워크 주소를 더욱 효율적으로 표현하고 사용하기 위해 개발된 방식이다. <br />
  CIDR 표기법은 IP 주소와 서브넷 마스크를 슬래시(/)로 구분해 나타낸다. <br />
  예를 들어, `192.168.1.0/24` 와 같은 형태로 표현된다. <br />
  여기서 `/24`는 서브넷 마스크가 24비트 길이임을 나타낸다.

### 서브넷 마스크

네트워크 주소 부분만 모두 1, 호스트 주소 부분은 0으로 설정해 나눈다.

| -   | Host | Netmask         |
| --- | ---- | --------------- |
| /30 | 4    | 255.255.255.252 |
| /29 | 8    | 255.255.255.248 |
| /28 | 16   | 255.255.255.240 |
| /27 | 32   | 255.255.255.224 |
| /26 | 64   | 255.255.255.192 |
| /25 | 128  | 255.255.255.128 |
| /24 | 256  | 255.255.255.0   |
| /23 | 512  | 255.255.254.0   |

### 10개의 사무실이 있고, 사무실당 12개의 장치를 연결해야 한다면?

한 서브네트워크당 123.12.12.12/28로 16개의 네트워크를 확보해야 한다. <br />
이를 통해 16-2 = 14개 장치를 확보할 수 있다.

---

## Public IP와 Private IP

IP 주소의 부족을 공인 IP와 사설 IP로 나누고, 중간에 NAT라는 기술을 통해 해결한다. <br />
NAT(Network Address Translation)은 패킷이 트래픽 라우팅 장치를 통해 전송되는 동안 패킷의 IP주소를 변경해서 IP주소를 다른 IP주소로 매핑하는 방법이다.

NAT을 통해 내부 네트워크 IP가 노출되지 않는다는 점 등이 장점이다.

### 공유기와 NAT

실생활에서 인터넷 회선 하나를 개통하고, 보통 공유기를 써서 wifi를 만들곤 한다. <br />
이때 여러 대의 호스트가 하나의 공인 IP 주소를 사용해 인터넷에 접속하게 된다.
