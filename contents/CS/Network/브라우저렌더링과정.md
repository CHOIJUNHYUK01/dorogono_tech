# 브라우저 렌더링 과정

브라우저는 `브라우저 엔진`, `렌더링 엔진`,`네트워크 통신부`,`자바스크립트 해석기`,`UI 백엔드`,`자료 저장소`로 이뤄져 있다. <br />
이 중 렌더링 엔진이 브라우저 렌더링을 담당한다. <br />
DOM 트리 CSS 파서 등을 기반으로 렌더 트리를 구축해, 결과적으로 우리가 보는 화면을 구축하는 과정을 의미한다.

## 1. DOM 트리와 CSSOM 트리 구축

### DOM 트리 구축

하나의 html 페이지는 div, span 등의 요소를 가진다. <br />
이 요소들이 HTML 파서에 의해 "구문 분석"된다.

요소는 하나 하나가 노드로 설정이 되어, 트리 형태로 저장된다. <br />
이를 DOM 트리라 한다. <br />
예를 들어 `div > span, span` 이라는 요소가 있다면, div라는 부모 노드 밑에 span이란 자식 노드가 2개 생긴다.

### CSSOM 트리 구축

각각의 노드는 CSS 파서에 의해 정해진 스타일 규칙이 적용되어 있다. <br />
`span.color = "red"`는 노드 색깔이 빨간색임을 말한다.

이런 것들을 기반으로 CSSOM이라는 트리가 만들어진다. <br />
이 과정은 DOM 트리 구축과 "동시에" 일어난다.

## 2. 렌더 트리와 렌더 레이어 생성

이제 DOM 트리와 CSSOM 트리가 합쳐져 랜더 객체가 생성된다. <br />
그리고 이들이 모여 병렬적인 렌더 트리가 생성된다.

이때, `display: none`이 포함된 노드는 지워진다. <br />
`font-size` 등 상속적인 스타일은 부모 노드에만 위치하도록 설계하는 등의 최적화를 거쳐 렌더 레이어가 완성된다. <br />
`visibility: hidden`은 요소를 보이지 않게 하지만, 요소는 여전히 레이아웃에서 공간을 차지한다.

렌더 레이어가 완성될 때, GPU에서 처리되는 부분 (CSS3D / video / canvas / filter / animation / transform )등이 있으면, 그 요소들은 각각 강제적으로 그래픽 레이어로 분리된다.

## 3. 렌더 레이어를 대상으로 Layout 설정

이때 좌표는 보통 부모를 기준으로 설정된다. <br />
Global Layout은 브라우저 사이즈가 증가하거나, 폰트 사이즈가 커지면 변경된다.

## 4. 렌더 레이어를 대상으로 칠하기 (paint)

픽셀마다 점을 찍듯 칠한다. <br />
이를 레스터화라고도 한다.

## 5. 레이어 합치기 (composite layer) 및 표기

각각의 레이어로부터 비트맵이 생성되고, GPU에 텍스처로 업로드 된다. <br />
그 다음 텍스쳐들은 서로 합쳐져 하나의 이미지로 렌더링되며, 화면으로 출력된다.

---

### 렌더 트리와 DOM 트리는 1 : 1 대응일까?

아니다.<br />
`DOM 트리 > 렌더 객체 > 렌더 트리`가 되는 과정에서 `display:none`으로 사라지는 렌더 객체가 있을 수 있기에 아니다.
