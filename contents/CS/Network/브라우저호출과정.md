# www.naver.com을 쳤을 때의 과정

리다이렉트, 캐싱, DNS, IP 라우팅, ARP, TCP 연결 구축을 거쳐 요청과 응답이 일어나는 TTFB(time to first byte)가 시작된다. <br />
그 이후 컨텐츠를 다운받고, 브라우저 렌더링 과정을 거쳐 네이버라는 화면이 나타난다.

## 리다이렉트

리다이렉트가 있다면 진행하고, 없다면 그대로 해당 요청에 대한 과정이 진행된다.

## 캐싱

해당 요청이 캐싱이 가능한지, 가능하지 않은지를 파악한다. <br />
캐싱이 이미 된 요청이라면, 캐싱된 값을 반환한다. <br />
캐싱이 되지 않은 새 요청이면, 그 다음 단계로 넘어간다.

캐싱은 요청된 결과값을 저장하고, 그 값을 다시 요청하면 다시 제공하는 기술이다. <br />
이는 브라우저 캐시와 공유 캐시로 나뉜다.

### 브라우저 캐시

쿠키, 로컬 스토리지 등을 포함한다. <br />
개인 캐시(private cache)라고도 한다.

브라우저 자체가 사용자가 HTTP를 통해 다운로드하는 모든 문서를 보유하는 것이다. <br />
예를 들어, 어떤 사이트를 재방문하면 굉장히 빠르게 컨텐츠가 나타난다. <br />
그게 바로 브라우저 캐시다. <br />
인터넷 사용 기록을 삭제하고 싶어서 누르려고 하면, 쿠키 및 기타 사이트 데이터, 캐시 부분이 브라우저 캐시다.

### 공유 캐시

클라이언트와 서버 사이에 있으면, 사용자 간에 공유할 수 있는 응답을 저장할 수 있다. <br />
대표적인 예로 요청한 서버 앞단에 프록시 서버가 캐싱을 하는 것이다. <br />
이를 리버스 프록시를 둬서 내부 서버로 포워드한다고도 한다.

예를 들어, Node.js로 서버를 구축한다면 앞단의 프록시 서버로 nginx서버를 둔다. <br />
이 서버를 캐싱 서버로 사용할 수 있다.

또한 AWS Cloudfront 또는 Cloudflare 같은 콘텐츠 전송 네트워크 (CDN)을 둬서 캐싱할 수 있다.

캐시가 없다면, 계속 요청이 생기지만, 공유 캐시와 브라우저 캐시를 통해 요청을 줄일 수 있다.

---

## DNS

이제 캐싱을 거쳐서 요청해야 함이 분명해졌다면, 실제 서버에 요청해야 한다. <br />
브라우저가 요청한 FQDN(Fully Qualified Domain Name)인 `www.naver.com`등의 이름을 DNS를 통해 실제 IP 주소를 확인한다.

**FQDN** : 호스트와 도메인이 합쳐진 완전한 도메인 이름이다. <br />
www 등은 호스트 부분이고, naver.com이 도메인이다.

DNS(Domain Name System)은 계층적인 도메인 구조와 분산된 데이터베이스를 이용한 시스템이다. <br />
FQDN을 인터넷 프로토콜인 IP로 바꿔주는 시스템이다. <br />
이는 DNS 관련 요청을 네임서버로 전달하고, 해당 응답값을 클라이언트에게 전달하는 리졸버, 도메인을 IP로 변환하는 네임 서버 등으로 이뤄져 있다.

예를 들어, `www.naver.com`에 DNS 쿼리가 온다고 해보자. <br />
오른쪽부터 역순으로 `[Root DNS]` -> `[.com DNS]` -> `[.naver DNS]` -> `[.www DNS]` 과정을 거쳐 완벽한 주소를 찾아 IP 주소를 매핑한다.

### DNS 캐싱

미리 해당 도메인 이름을 요청했다면, 로컬 PC에 자동으로 저장된다. <br />
브라우저 캐싱과 OS 캐싱이 있다.

**브라우저 캐싱** : chrome://net-internals/#dns <br />
**OS 캐싱** : ipconfig/displaydns

---

## IP 라우팅

해당 IP를 기반으로 IP 라우팅이 일어나고, ARP 과정을 거쳐 실제 서버를 찾는다.

## TCP 연결 구축

이제 브라우저가 TCP 3웨이-핸드셰이크 및 SSL 연결 등을 통해 연결을 설정한다. <br />
이후 요청을 보낸 후, 드이어 해당 요청한 서버로부터 응답을 받는다.

TCP 연결은 HTTP/2까지 일어난다. <br />
HTTP/3는 QUIC을 통해 연결하고, 데이터를 주고 받는다.

## 콘텐츠 다운로드

브라우저는 사용자가 요청한 컨텐츠를 서버로부터 다운받는다.

## 브라우저 렌더링

받은 데이터를 바탕으로 브라우저 엔진이 브라우저 렌더링 과정을 거쳐 화면을 만든다.
